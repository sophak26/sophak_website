<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Husky Hub</title>
<style>html,body{margin:0;height:100%;background:#0a2239;color:#e9f2ff;font-family:system-ui}#game{width:100vw;height:100vh}</style>
<div id="game">Loading…</div>
<script>
(function(){
  // Add/rename files as needed; make sure docs/rsvp.html and docs/faq.html exist
  var DOORS = [
    { label:'Schedule', url:'schedule.html', x:900,  y:460 }, // sits above platform at y~420
    { label:'RSVP',     url:'rsvp.html',     x:1400, y:390 }, // above platform y~350
    { label:'FAQ',      url:'faq.html',      x:1900, y:320 }  // above platform y~280
  ];

  function load(src, ok, fail){var s=document.createElement('script');s.src=src;s.onload=ok;s.onerror=fail;document.head.appendChild(s);}
  load('https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js', start, function(){
    load('https://unpkg.com/phaser@3.55.2/dist/phaser.min.js', start, start);
  });

  function start(){
    if(!window.Phaser){ document.getElementById('game').textContent='Could not load Phaser'; return; }

    var W=960,H=540,WORLD=2300,G=1300;
    var cursors, player, platforms, doors, hint, particles;

    new Phaser.Game({
      type: Phaser.CANVAS,
      backgroundColor: '#0a2239',
      parent: 'game',
      scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH, width: W, height: H },
      physics: { default:'arcade', arcade:{ gravity:{ y:G }, debug:false } },
      scene: { preload:preload, create:create, update:update }
    });

    function preload(){
      // white pixel for rectangles
      var g=this.add.graphics(); g.fillStyle(0xffffff,1).fillRect(0,0,2,2); g.generateTexture('white',2,2); g.destroy();
      // winter gradient bg
      var gg=this.add.graphics(); gg.fillGradientStyle(0x0b1b2a,0x0b1b2a,0x1a3d5e,0x1a3d5e,1); gg.fillRect(0,0,W,H); gg.generateTexture('bg_grad',W,H); gg.destroy();
      // snowflake
      var sf=this.add.graphics(); sf.fillStyle(0xffffff,1); sf.fillCircle(3,3,3); sf.generateTexture('flake',6,6); sf.destroy();
      // husky image (put docs/assets/husky.png in your repo)
      this.load.image('husky','assets/husky.png');
    }

    function create(){
      // background
      this.add.image(0,0,'bg_grad').setOrigin(0,0).setScrollFactor(0).setDepth(-10);

      // snowfall (3.55.2-safe)
      particles = this.add.particles('flake');
      if (particles.setScrollFactor) particles.setScrollFactor(0);
      particles.setDepth(-5);
      particles.createEmitter({
        x:{min:0,max:W}, y:0, lifespan:6000,
        speedY:{min:50,max:130}, speedX:{min:-20,max:20},
        scale:{start:0.6,end:0.1}, quantity:3, blendMode:'ADD'
      });

      // world + camera
      this.physics.world.setBounds(0,0,WORLD,H);
      this.cameras.main.setBounds(0,0,WORLD,H);

      // platforms (place under each door)
      platforms=this.physics.add.staticGroup();
      addPlatform(this, WORLD/2, H-20, WORLD, 40, 0x6ed4ff); // ground
      addPlatform(this, 700,  420, 320, 24, 0x6ed4ff);
      addPlatform(this, 1150, 350, 320, 24, 0x6ed4ff);
      addPlatform(this, 1500, 310, 280, 24, 0x6ed4ff);
      addPlatform(this, 1900, 280, 280, 24, 0x6ed4ff);

      // husky player
      player=this.physics.add.sprite(100,H-200,'husky');
      var scale=1.6; player.setScale(scale);
      player.body.setSize(player.width*0.5, player.height*0.7, true);
      player.setBounce(0.1).setCollideWorldBounds(true);
      this.physics.add.collider(player,platforms);

      // controls
      cursors=this.input.keyboard.createCursorKeys();

      // doors
      doors=this.physics.add.staticGroup();
      for (var i=0;i<DOORS.length;i++){
        var d=DOORS[i];
        var door=doors.create(d.x,d.y-40,'white').setDisplaySize(36,64).setTint(0xc3e7ff).refreshBody();
        door.setData('url',d.url);
        this.add.text(d.x,d.y-88,d.label,{fontSize:'16px',color:'#e9f2ff'}).setOrigin(0.5);
      }

      // enter door: E key or click/tap while overlapping a door
      var keyE=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E);
      this.physics.add.overlap(player,doors,function(){ showHint(this,'Press E or tap to enter'); },null,this);
      this.input.keyboard.on('keydown-E',enterIfOverlapping, this);
      this.input.on('pointerdown', function(){
        var entered = enterIfOverlapping.call(this);
        if(!entered && player.body.blocked.down) player.setVelocityY(-520); // otherwise: jump
      }, this);

      // camera + help
      this.cameras.main.startFollow(player,true,0.1,0.1);
      this.add.text(16,16,'← → move, Space/↑ jump, E/tap to enter',{fontSize:'16px',color:'#cfe9ff'}).setScrollFactor(0);
    }

    function update(){
      if(hint) hint.setVisible(false);
      var speed=240;
      if(cursors.left.isDown){ player.setVelocityX(-speed); player.setFlipX(true); }
      else if(cursors.right.isDown){ player.setVelocityX(speed); player.setFlipX(false); }
      else { player.setVelocityX(0); }
      if((cursors.up.isDown||cursors.space.isDown) && player.body.blocked.down) player.setVelocityY(-520);
    }

    function enterIfOverlapping(){
      var did=false;
      this.physics.overlap(player, doors, function(_p,door){
        did=true;
        try{ localStorage.setItem('wedding_unlocked','1'); }catch(e){}
        location.href = door.getData('url');
      });
      return did;
    }
    function addPlatform(scene,x,y,w,h,t){ var p=platforms.create(x,y,'white').setDisplaySize(w,h).refreshBody(); p.setTint(t); return p; }
    function showHint(scene,msg){
      if(!hint){ hint=scene.add.text(0,0,msg,{fontSize:'16px',color:'#fff',backgroundColor:'#173554aa',padding:{left:6,right:6,top:4,bottom:4}}).setScrollFactor(0); }
      hint.setVisible(true).setPosition(W/2-hint.width/2,H-48);
    }
  }
})();
</script>
