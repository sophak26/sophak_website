<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Husky Runner — Wedding</title>
<style>
  html,body{margin:0;height:100%;background:#0b1b2a;color:#e9f2ff;font-family:system-ui,Segoe UI,Helvetica,Arial,sans-serif}
  #game{width:100vw;height:100vh}
  .fallback{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
</style>
<div id="game"><div class="fallback">Loading…</div></div>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
<script>
(() => {
  // Pages your doors should open (use relative links so GitHub Pages paths Just Work)
  const DOORS = [
    { label: "Schedule", url: "schedule.html", x: 900,  y: 460 },
    { label: "RSVP",     url: "rsvp.html",     x: 1400, y: 380 },
    { label: "FAQ",      url: "faq.html",      x: 1900, y: 300 },
  ];

  const WIDTH = 960, HEIGHT = 540, WORLD_W = 2400, G = 1300;

  const config = {
    type: Phaser.AUTO,
    parent: "game",
    width: WIDTH, height: HEIGHT,
    physics: { default: "arcade", arcade: { gravity: { y: G }, debug: false } },
    scene: { preload, create, update }
  };

  let cursors, keyE;
  let player, platforms, doorsGroup, hintText;

  new Phaser.Game(config);

  function preload() {
    // Create a 2x2 white texture we can tint/scale for rectangles (ground, doors, placeholder husky)
    const g = this.add.graphics();
    g.fillStyle(0xffffff, 1); g.fillRect(0, 0, 2, 2);
    g.generateTexture("white", 2, 2); g.destroy();

    // Optional: when you add art later
    // this.load.spritesheet("husky", "assets/husky.png", { frameWidth: 32, frameHeight: 32 });
    // this.load.image("background", "assets/winter-bg.png");
    // this.load.image("door", "assets/door.png");
  }

  function create() {
    // Snowy night backdrop
    this.cameras.main.setBackgroundColor("#0a2239"); // deep blue
    addSnow(this);

    // World bounds and camera
    this.physics.world.setBounds(0, 0, WORLD_W, HEIGHT);
    this.cameras.main.setBounds(0, 0, WORLD_W, HEIGHT);

    // Platforms (static bodies)
    platforms = this.physics.add.staticGroup();
    addPlatform(this, WORLD_W/2, HEIGHT-20, WORLD_W, 40, 0x6ed4ff); // ice ground
    addPlatform(this, 700,  420, 320, 24,  0x6ed4ff);
    addPlatform(this, 1150, 350, 260, 24,  0x6ed4ff);
    addPlatform(this, 1650, 280, 240, 24,  0x6ed4ff);
    addPlatform(this, 2050, 360, 300, 24,  0x6ed4ff);

    // Player (placeholder husky = light rectangle; replace with sprite later)
    player = this.physics.add.sprite(100, HEIGHT - 200, "white").setDisplaySize(38, 30).setTint(0xeef7ff);
    player.setBounce(0.1).setCollideWorldBounds(true).body.setSize(38, 30);
    this.physics.add.collider(player, platforms);

    // Controls
    cursors = this.input.keyboard.createCursorKeys();
    keyE = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E);

    // Doors
    doorsGroup = this.physics.add.staticGroup();
    for (const d of DOORS) {
      const door = doorsGroup.create(d.x, d.y - 40, "white").setDisplaySize(36, 64).setTint(0xc3e7ff).refreshBody();
      door.setData("url", d.url).setData("label", d.label);
      // label above door
      const label = this.add.text(d.x, d.y - 88, d.label, { fontSize: "16px", color: "#e9f2ff" }).setOrigin(0.5);
    }
    // Overlap to show hint; entering happens only when E is pressed
    this.physics.add.overlap(player, doorsGroup, () => showHint(this, "Press E to enter"), () => true, this);

    // When E is pressed, if overlapping a door, go there
    this.input.keyboard.on("keydown-E", () => {
      this.physics.overlap(player, doorsGroup, (_p, door) => {
        localStorage.setItem("wedding_unlocked", "1"); // simple "gate" flag
        window.location.href = door.getData("url");
      });
    });

    // Basic mobile support: tap to jump
    this.input.on("pointerdown", () => {
      if (player.body.blocked.down) player.setVelocityY(-520);
    });

    this.cameras.main.startFollow(player, true, 0.1, 0.1);
    // On-screen help
    this.add.text(16, 16, "← → move, Space/↑ jump, E enter door", { fontSize: "16px", color: "#cfe9ff" }).setScrollFactor(0);
  }

  function update() {
    // Clear hint each frame; overlap will re-show if still at a door
    if (hintText) { hintText.setVisible(false); }

    // Horizontal move
    const speed = 240;
    if (cursors.left.isDown) {
      player.setVelocityX(-speed); player.setFlipX(true);
    } else if (cursors.right.isDown) {
      player.setVelocityX(speed); player.setFlipX(false);
    } else {
      player.setVelocityX(0);
    }
    // Jump
    if ((cursors.up.isDown || cursors.space.isDown) && player.body.blocked.down) {
      player.setVelocityY(-520);
    }
  }

  // Helpers
  function addPlatform(scene, x, y, w, h, tint) {
    const p = platforms.create(x, y, "white").setDisplaySize(w, h).refreshBody();
    p.setTint(tint);
    return p;
  }
  function showHint(scene, msg) {
    if (!hintText) {
      hintText = scene.add.text(0, 0, msg, { fontSize: "16px", color: "#fff", backgroundColor:"#173554aa", padding:{left:6,right:6,top:4,bottom:4} }).setScrollFactor(0);
    }
    hintText.setVisible(true).setPosition(WIDTH/2 - hintText.width/2, HEIGHT - 48);
  }
  function addSnow(scene) {
    // make a small circular “flake” texture
    const g = scene.add.graphics();
    g.fillStyle(0xffffff, 1); g.fillCircle(3, 3, 3); g.generateTexture("flake", 6, 6); g.destroy();
    const particles = scene.add.particles("flake");
    particles.createEmitter({
      x: { min: 0, max: WORLD_W }, y: 0, lifespan: 6000,
      speedY: { min: 50, max: 130 }, speedX: { min: -20, max: 20 },
      scale: { start: 0.6, end: 0.1 }, quantity: 3, blendMode: "ADD"
    });
  }
})();
</script>
